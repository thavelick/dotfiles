PATH=$PATH:$HOME/.local/bin

HISTSIZE=100000
SAVEHIST=100000
HISTFILE=~/.cache/zsh/history

export DOTFILES_HOME=$HOME/Projects/dotfiles
export EDITOR=vim
export BROWSER=qutebrowser
export GPG_TTY=$TTY
export MOZ_ENABLE_WAYLAND="1"
export QT_QPA_PLATFORM="wayland"
export XKB_DEFAULT_LAYOUT="us(colemak)"

source "$DOTFILES_HOME/zsh/keys.zsh"
source $HOME/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
source $HOME/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh

[[ -n $(diff --version | grep GNU) ]] && alias diff='diff --color'
alias batp='bat --style=plain'
which lsd > /dev/null && alias ls='lsd'
which nvim > /dev/null && alias vim='nvim'
alias ru2en='argos-translate --from-lang ru --to-lang en'

nboffline() {
  document=$1
  nb --no-color bookmark list | grep -F "[$document]" && \
    nb --no-color show $document | tail +8 | head -n -1 | w3m -T 'text/html'
}

qr-paste () {
  [[ -f /usr/sbin/wl-paste ]] && /usr/sbin/wl-paste | \
    qrencode -o - -t PNG | imv -
}

def() {
	sdcv -n --utf8-output "$@" 2>&1 | sed 's/-->/<p>-->/g' | w3m -T text/html -dump | less -EXFRfM
}

uniclip() {
    cat $DOTFILES_HOME/zsh/latex_symbols.txt| fzf --query $1 | tr -s ' ' | cut -d ' ' -f2 | tr -d "\n" | wl-copy
}

foreground() {
    fg
}

zle -N foreground
# use ctrl-z to toggle in and out of bg
if [[ $- == *i* ]]; then
  stty susp undef
  bindkey "^Z" foreground
fi

# If windows defaults us to it's home directory, swtich to the unix one
[ $(pwd) = "/mnt/c/Users/trist" ] && cd $HOME || true

# store secrets outside of source control
[ -f $HOME/secrets.zsh ] && source $HOME/secrets.zsh || true

# If this is a work computer, include work specific stuff
[ -f $HOME/work.zsh ] && source $HOME/work.zsh && source $DOTFILES_HOME/work/github.zsh || true

source $DOTFILES_HOME/gemini.zsh

setopt interactive_comments
$HOME/Projects/nag-runner/nag_runner.py


# prompt
autoload -Uz vcs_info
zstyle ':vcs_info:*' enable git
zstyle ':vcs_info:*' check-for-changes true
zstyle ':vcs_info:*' unstagedstr 'ðŸš§'
zstyle ':vcs_info:*' stagedstr 'ðŸ’¾'

precmd() {
  current_directory=$(pwd)
  if [[ $current_directory != $HOME/Projects/* ]]; then
    # skip doing stuff with git prompts if we're outside of ~/Projects
    # to avoid running rogue payloads in untrusted folders when we automatically
    # run git commands

    # make sure any previous prompts from within ~/Projects are cleared out
    vcs_info_msg_0_=""
    return
  fi

  unpushed_commits=''
  untracked_files=''
  if [ "$(git rev-parse --is-inside-work-tree 2>/dev/null)" = "true" ]; then
    # we're in a git project, show git info in the prompt
    unpushed_count=$(git rev-list --count @{u}..)
    if [[ $unpushed_count -gt 0 ]]; then
      unpushed_commits='ðŸ”¥'
    fi
    if [[ -n $(git ls-files --others --exclude-standard) ]]; then
      untracked_files='ðŸŒ±'
    fi
  fi
  zstyle ':vcs_info:git:*' formats "(%b%u%c${unpushed_commits}${untracked_files})%m "
  vcs_info
}
setopt prompt_subst

PROMPT='%~ ${vcs_info_msg_0_}% âžœ '
